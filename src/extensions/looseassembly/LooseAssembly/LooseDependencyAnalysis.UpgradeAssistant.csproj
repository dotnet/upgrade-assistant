<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.DotNet.UpgradeAssistant.Abstractions" Version="0.2.237901" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Chem.Indexing.Client\Chem.Indexing.Client.csproj">
      <Private>true</Private>
    </ProjectReference>
  </ItemGroup>

  <ItemGroup>
    <None Update="ExtensionManifest.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <!-- Ensure the extension is published on build -->
  <!-- NOTE: This will be provided by the abstractions library in the near future -->
  <Target Name="PublishUpgradeAssistant" AfterTargets="Build" DependsOnTargets="Publish">
    <PropertyGroup>
      <ExtensionOutputDirectory Condition=" '$(ExtensionOutputDirectory)' == '' ">$(OutDir)</ExtensionOutputDirectory>
      <ExtensionOutputPath>$(ExtensionOutputDirectory)$(AssemblyName).zip</ExtensionOutputPath>
    </PropertyGroup>
        <ZipDirectory Overwrite="true" SourceDirectory="$(PublishDir)" DestinationFile="$(ExtensionOutputPath)" />
        <Message Importance="High" Text="Created Upgrade Assistant Extension: $(ExtensionOutputPath)" />
  </Target>

</Project>
